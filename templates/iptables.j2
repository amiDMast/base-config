# Generated by ANSUBLE roles
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
{% for item in iptables_list %}
{% if item.protocol == 'icmp' %}
# ICMP rules
{% for item_list in item.ipset_list %}-A INPUT -p {{ item.protocol }} -m set --match-set {{ item_list }} src -m icmp --icmp-type 8 -j ACCEPT
{% endfor %}
{% endif %}
{% if item.tcp is defined %}
# TCP rules
{% for item_list in item.ipset_list %}-A INPUT -p {{ item.protocol }} -m set --match-set {{ item_list.name }} src -m multiport --dports {{ item_list.dports }} -j ACCEPT
{% endfor %}
{% endif %}
{% if item.udp is defined %}
# UDP rules
{% for item_list in item.ipset_list %}-A INPUT -p {{ item.protocol }} -m set --match-set {{ item_list.name }} src -m multiport --dports {{ item_list.dports }} -j ACCEPT
{% endfor %}
{% endif %}
{% if item.protocol == 'esp' %}
# ESP rules
-A INPUT -p {{ item.protocol }} -j ACCEPT
{% endif %}
{% endfor %}
COMMIT
# Completed
